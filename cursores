/* CURSORES Ã‰ O MESMO QUE VETOR */

/* CONSOME MUITA MEMORIA */

CREATE DATABASE CURSORES;
USE CURSORES;

CREATE TABLE VENDEDORES(
	IDVENDEDOR INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(50),
	JAN INT,
	FEV INT,
	MAR INT
);

INSERT INTO VENDEDORES VALUES(NULL, 'MAFRA', 32432,425534,574545);
INSERT INTO VENDEDORES VALUES(NULL, 'CLARA', 456452,2488874,45464545);
INSERT INTO VENDEDORES VALUES(NULL, 'JOAO', 544874,248787,578784);
INSERT INTO VENDEDORES VALUES(NULL, 'LILIAN', 654654,248787,54874545);
INSERT INTO VENDEDORES VALUES(NULL, 'ANTONIO', 32444878,287834,6288745);
INSERT INTO VENDEDORES VALUES(NULL, 'GLORA', 3248787,8878234,878745);

SELECT * FROM VENDEDORES;

SELECT NOME, (JAN+FEV+MAR) AS TOTAL FROM VENDEDORES;
SELECT NOME, (JAN+FEV+MAR) AS TOTAL, TRUNCATE((JAN+FEV+MAR)/3,2) AS MEDIA FROM VENDEDORES;

CREATE TABLE VEND_TOTAL(
	NOME VARCHAR(50),
	JAN INT,
	FEV INT,
	MAR INT,
	TOTAL INT,
	MEDIA INT
);

DELIMITER $

CREATE PROCEDURE INSEREDADOS()
BEGIN
		DECLARE FIM INT DEFAULT 0;
		DECLARE VAR1, VAR2, VAR3, VTOTAL, VMEDIA INT;
		DECLARE VNOME VARCHAR(50);

		DECLARE REG CURSOR FOR(
			SELECT NOME, JAN, FEV, MAR FROM VENDEDORES
		);

		DECLARE CONTINUE HANDLER FOR NOT FOUND SET FIM = 1;

		OPEN REG;

		REPEAT

			FETCH REG INTO VNOME, VAR1, VAR2, VAR3;
			IF NOT FIM THEN 

				SET VTOTAL = VAR1 + VAR2 + VAR3;
				SET VMEDIA = VTOTAL / 3;

				INSERT INTO VEND_TOTAL VALUES(VNOME, VAR1, VAR2, VAR3, VTOTAL, VMEDIA);

			END IF;

		UNTIL FIM END REPEAT;

		CLOSE REG;
END
$

DELIMITER ;

SELECT * FROM VENDEDORES;
SELECT * FROM VEND_TOTAL;

CALL INSEREDADOS();